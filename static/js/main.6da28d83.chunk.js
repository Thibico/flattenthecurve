(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{156:function(t,e,n){t.exports=n.p+"static/media/gnpc_commodity_exports.97d62662.csv"},163:function(t,e,n){t.exports=n(237)},168:function(t,e,n){},169:function(t,e,n){t.exports=n.p+"static/media/logo.5d5d9eef.svg"},170:function(t,e,n){},172:function(t,e,n){},235:function(t,e,n){},237:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(17),o=n.n(i),l=(n(168),n(161)),c=n(104),s=n(105),u=n(108),d=n(106),h=n(50),f=n(109),p=(n(169),n(170),n(171),n(80)),m=n.n(p),g=(n(101),n(25),n(32)),b=(n(156),n(172),n(64)),x=n(137),v=n(66),y=n(238),w=n(118),O=n(103),D=n(82),j=n(157),M=n(2),P=n(112),E=function(t){return["normal","mild","severe","dead"][t]},k=n(158),R=n(28),T=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(u.a)(this,Object(d.a)(e).call(this,t))).setHeightFromDateExtant=function(t,e){return n.setHeight(e.diff(t,"months"))},n.setHeight=function(t){return 180*t+500},n.createChart=n.createChart.bind(Object(h.a)(n)),n.state={height:4e3},n}return Object(f.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){console.log(this.props),this.setState({height:this.props.timeline?this.setHeightFromDateExtant(this.props.minDate,this.props.maxDate):this.setHeight(this.props.data.length),months:this.props.timeline?this.props.maxDate.diff(this.props.minDate,"months"):0}),this.createChart()}},{key:"componentDidUpdate",value:function(){this.createChart()}},{key:"componentWillReceiveProps",value:function(t){t.data===this.props.data&&t.timeline===this.props.timeline||this.setState({height:t.timeline?this.setHeightFromDateExtant(t.minDate,t.maxDate):this.setHeight(t.data.length),months:t.timeline?t.maxDate.diff(t.minDate,"months"):0})}},{key:"createChart",value:function(){var t=this.props.data?this.props.data:[],e=this.props,n=e.revAsCircles,a=e.timeline,r={top:150,right:5,bottom:5,left:this.props.width/3},i=this.props.width-r.left-r.right,o=this.state.height-r.top-r.bottom,l=Object(b.a)(this.node);console.log(t),console.log(n),(t=m.a.sortBy(t,"Date_of_sale")).forEach(function(t){t.yRevBottom=0,t.yRevTop=0});var c=Object(D.b)(",.2f"),s=Object(v.a)().range([o,0]),u=Object(v.a)().range([o,0]),d={xOffset:0,yOffset:0,width:i/8,height:o,labelPositioning:{alpha:.5,spacing:18},leftTitle:"Lifting",rightTitle1:"Buyer",rightTitle2:"& Destination",leftSubTitle:"Date of Sale",rightSubTitle:"Payment Due Date",labelGroupOffset:5,labelKeyOffset:50,radius:6,subTitleYShift:20,unfocusOpacity:.3,revWidthMultiple:3.5,priceWidthMultiple:1.5,timelineWidthMultiple:.6},h={maxwidth:i/15>20?i/15:20,height:10,color:"#ecb600",highlightColor:"#CE1126",border:"#eee",volWidth:2.5,revBoxesPerCol:10,maxRevWidth:400,volTitle:"Volume (barrels)",priceTitle1:"Price",priceTitle2:"(US$)",revTitle1:"Revenue",revTitle2:"(US$)"},f=Object(j.a)().attr("class","d3-tip").offset([0,20]).direction(function(t){return n?"e":"se"}).html(function(t){return function(t,e){var n="<div class='tootltip' style='font-size:12px; border: 1px solid #ccc; background-color: rgba(255,255,255,0.9); padding:5px; max-width:350px; z-index:2000'>";return n+=t?"<div style='font-size:20px'>"+t+"</div>":"",e&&e.forEach(function(t){n+="<br/><strong>"+t.label+":</strong> ",n+="<div class='tootltip-value' style='font-size:18px;'>"+t.value+"</div>"}),n+="</div>"}(t.year,[{label:"Lifting",value:t.Lifting},{label:"Date of Sale",value:t.Date_of_sale.format("D MMM YYYY")},{label:"Payment Receipt Date",value:t.Payment_receipt_date.format("D MMM YYYY")},{label:"Price",value:"US$ "+c(t.Price)+" per barrel"},{label:"Volume",value:c(t.Volume)+" barrels"},{label:"Revenue",value:"US$ "+c(t.Revenue)},{label:"Buyer",value:t.Buyer},{label:"Destination",value:t.Destination}])});l.selectAll("g").remove();Object(y.a)(w.a).domain([0,10]),Object(R.c)("%s");var p=function(t,e){return a?s(t):u(e)},E=g(g.max(t.map(function(t){return t.Payment_receipt_date})).toDate()),T=g(g.min(t.map(function(t){return t.Date_of_sale})).toDate());s.domain([P.a.floor(E.add(2,"months")),P.a.floor(T.subtract(1,"months"))]),u.domain([t.length,-1]),console.log(s.domain()),console.log(P.a.range(P.a.floor(s.domain()[0]),P.a.ceil(s.domain()[1]))),a&&l.append("g").attr("class","grid").attr("transform","translate(0,"+r.top+")").call(function(t,e,n){return console.log(e,n),console.log(P.a.range(e,n).map(function(t){return+t})),Object(O.b)(s).tickValues(P.a.range(e,n).map(function(t){return+t}))}(this.state.months,s.domain()[1],s.domain()[0]).tickSize(2*-i).tickFormat(function(t){return Object(R.b)("%b %Y")(t)})),l.selectAll(".grid text").attr("dy",20).attr("dx",10);var S=l.append("g").attr("class","borderLines").attr("transform","translate("+r.left+","+r.top+")");S.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",d.height),S.append("line").attr("x1",d.width*d.timelineWidthMultiple).attr("y1",0).attr("x2",d.width*d.timelineWidthMultiple).attr("y2",d.height);var W=l.append("g").selectAll("g").data(t).enter().append("g").attr("transform","translate("+r.left+","+r.top+")").attr("class","slope-group").attr("id",function(t,e){t.id="group"+t.Lifting,t.sellDate=t.Date_of_sale.toDate(),t.paymentDate=t.Payment_receipt_date.toDate()}),C=(W.append("line").attr("class","slope-line").attr("x1",0).attr("y1",function(t,e){return p(t.sellDate,e)}).attr("x2",d.width*d.timelineWidthMultiple).attr("y2",function(t,e){return p(t.paymentDate,e)}),W.append("circle").attr("class",function(t){return"circle"}).attr("r",d.radius).attr("cy",function(t,e){return p(t.sellDate,e)}),W.append("g").attr("class","slope-label-left").each(function(t,e){t.xLeftPosition=-d.labelGroupOffset,t.yLeftPosition=p(t.sellDate,e)}));C.append("text").attr("class","label-figure-small").attr("x",function(t){return t.xLeftPosition}).attr("y",function(t){return t.yLeftPosition}).attr("dx",-10).attr("dy",d.subTitleYShift).attr("text-anchor","end").text(function(t){return t.Date_of_sale.format("D MMM YYYY")}),C.append("text").attr("class","label-figure").attr("x",function(t){return t.xLeftPosition}).attr("y",function(t){return t.yLeftPosition}).attr("dx",-10).attr("dy",3).attr("text-anchor","end").text(function(t){return t.Lifting});W.append("circle").attr("class",function(t){return"circle"}).attr("r",d.radius).attr("cx",d.width*d.timelineWidthMultiple).attr("cy",function(t,e){return p(t.paymentDate,e)});var Y=W.append("g").attr("class","slope-label-right").each(function(t,e){t.xRightPosition=d.width*d.timelineWidthMultiple+d.labelGroupOffset,t.yRightPosition=p(t.paymentDate,e)});Y.append("text").attr("class","label-figure-small").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",2*d.subTitleYShift).attr("text-anchor","start").text(function(t){return t.Payment_receipt_date.format("D MMM YYYY")}),Y.append("text").attr("class","label-figure").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",3).attr("text-anchor","start").text(function(t){return t.Buyer}),Y.append("text").attr("class","label-figure").attr("x",function(t){return t.xRightPosition}).attr("y",function(t){return t.yRightPosition}).attr("dx",10).attr("dy",3+d.subTitleYShift).attr("text-anchor","start").text(function(t){return t.Destination});var _=l.append("g").attr("transform","translate(0,"+r.top+")").attr("class","title");_.append("text").attr("text-anchor","end").attr("x",r.left).attr("dx",-10).attr("dy",-r.top/4).text(d.leftTitle),_.append("text").attr("text-anchor","end").attr("class","label-figure-small").attr("x",r.left).attr("dx",-10).attr("dy",-r.top/4+d.subTitleYShift).text(d.leftSubTitle),_.append("text").attr("x",r.left+d.width*d.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4).text(d.rightTitle1),_.append("text").attr("x",r.left+d.width*d.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4+d.subTitleYShift).text(d.rightTitle2),_.append("text").attr("class","label-figure-small").attr("x",r.left+d.width*d.timelineWidthMultiple).attr("dx",10).attr("dy",-r.top/4+2*d.subTitleYShift).text(d.rightSubTitle);var B=l.append("g").attr("transform","translate("+(r.left+d.width)+","+r.top+")").attr("class","price"),A=Object(v.a)().range([0,h.maxwidth]).domain([0,100]),L=Object(M.k)(t.map(function(t){return t.Revenue})),H=Object(v.a)().range([0,d.width]).domain([0,Math.sqrt(L)]);function N(t){return t.Lifting.split(" ").join("").toLowerCase()}var z=[],I=[];B.selectAll(".bar").data(t).enter().append("rect").attr("class",function(t){return"bar price "+N(t)}).attr("x",function(t){return d.width*d.priceWidthMultiple}).attr("width",function(t){return A(+t.Price)}).attr("y",function(t,e){return t.yRightPosition-h.height/2}).attr("fill",function(t){return h.color}).attr("stroke",function(t){return h.border}).attr("height",function(t){return h.height}).on("mouseover",function(t){f.show(t,this),Object(x.a)("."+N(t)).attr("fill",h.highlightColor),Object(x.a)(".annote."+N(t)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(x.a)("."+N(t)).attr("fill",h.color),Object(x.a)(".annote."+N(t)).attr("display","none")}),n&&(I.push(l.append("g").attr("transform","translate("+(r.left+d.width*d.revWidthMultiple)+","+r.top+")").attr("class",function(t){return"rev"})),I[0].selectAll(".bar").data(t).enter().append("circle").attr("class",function(t){return"bar rev "+N(t)}).attr("cx",function(t){return d.width}).attr("r",function(t){return H(Math.sqrt(+t.Revenue))}).attr("cy",function(t){return t.yRightPosition}).attr("fill",function(t){return h.color}).attr("stroke",function(t){return h.border}).on("mouseover",function(t){f.show(t,this),Object(x.a)("."+N(t)).attr("fill",h.highlightColor),Object(x.a)(".annote."+N(t)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(x.a)("."+N(t)).attr("fill",h.color),Object(x.a)(".annote."+N(t)).attr("display","none")})),_.append("text").attr("text-anchor","start").attr("x",r.left+d.width*(d.priceWidthMultiple+1)).attr("dx",-10).attr("dy",-r.top/4).text(h.priceTitle1),_.append("text").attr("text-anchor","start").attr("x",r.left+d.width*(d.priceWidthMultiple+1)).attr("dx",-10).attr("dy",-r.top/4+d.subTitleYShift).text(h.priceTitle2),_.append("text").attr("text-anchor","start").attr("x",0).attr("dx",0).attr("dy",-r.top/4).text(h.volTitle),_.append("text").attr("text-anchor","start").attr("x",r.left+d.width*d.revWidthMultiple).attr("dx",0).attr("dy",-r.top/4).text(h.revTitle1),_.append("text").attr("x",r.left+d.width*d.revWidthMultiple).attr("dx",0).attr("dy",-r.top/4+d.subTitleYShift).text(h.revTitle2);var V=t.map(function(t){return m.a.range(0,Math.round(t.Volume/1e4))});t.forEach(function(e,a){z.push(l.append("g").attr("transform","translate(10,"+r.top+")").attr("class",function(t){return"volume"})),I.push(l.append("g").attr("transform","translate("+(r.left+d.width*d.revWidthMultiple)+","+r.top+")").attr("class",function(t){return"rev"})),z[a].selectAll(".bar").data(V[a]).enter().append("rect").attr("class",function(t){return"bar vol "+N(e)}).attr("x",function(t,e){return h.volWidth*e}).attr("width",function(t){return h.volWidth}).attr("y",function(t,n){return e.yLeftPosition-h.height/2}).attr("fill",function(t){return h.color}).attr("stroke",function(t){return h.border}).attr("height",function(t){return h.height}).on("mouseover",function(t){f.show(e,this),Object(x.a)("."+N(e)).attr("fill",h.highlightColor),Object(x.a)(".annote."+N(e)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(x.a)("."+N(e)).attr("fill",h.color),Object(x.a)(".annote."+N(e)).attr("display","none")}),n||I[a].selectAll(".bar").data(V[a]).enter().append("rect").attr("class",function(t){return"bar rev "+N(e)}).attr("x",function(t,n){var a=A(+e.Price);return Math.floor(n/h.revBoxesPerCol)*a}).attr("width",function(t){return A(+e.Price)}).attr("y",function(n,r){var i=r%h.revBoxesPerCol,o=e.yRightPosition-h.height/2+h.height*i;return t[a].yRevBottom=t[a].yRevBottom>o+h.height?t[a].yRevBottom:o+h.height,o}).attr("fill",function(t){return h.color}).attr("stroke",function(t){return h.border}).attr("height",function(t){return h.height}).on("mouseover",function(t){f.show(e,this),Object(x.a)("."+N(e)).attr("fill",h.highlightColor),Object(x.a)(".annote."+N(e)).attr("display","block")}).on("mouseout",function(t){f.hide(),Object(x.a)("."+N(e)).attr("fill",h.color),Object(x.a)(".annote."+N(e)).attr("display","none")}),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","left").attr("class",function(t){return"annote vol "+N(e)}).attr("x",10).attr("dx",0).attr("y",e.yLeftPosition-10).attr("fill",h.color).attr("display","none").text(c(e.Volume)+" barrels"),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","middle").attr("class",function(t){return"annote price "+N(e)}).attr("x",r.left+d.width*(d.priceWidthMultiple+1.25)).attr("dx",0).attr("y",e.yRightPosition).attr("dy",-10).attr("fill",h.color).attr("display","none").text("US$ "+c(e.Price)+" per barrel"),l.append("g").attr("transform","translate(0,"+r.top+")").append("text").attr("text-anchor","left").attr("class",function(t){return"annote rev "+N(e)}).attr("x",function(){var t=r.left+d.width*(d.revWidthMultiple+.5);return n?t-d.width:t}).attr("dx",0).attr("y",function(r){t[a].yRevTop=e.yRightPosition-30;var i=e.yRightPosition-10;return n?i-d.width:i}).attr("fill",h.color).attr("display","none").text("US$ "+c(e.Revenue)+" in revenue ")}),console.log(t);for(var U=0,$=t.length-1;$>0;$--)for(var F=t.length-1;F>0;F--)if((U=t[F-1].yRevBottom>t[F].yRevTop?t[F-1].yRevBottom-t[F].yRevTop:0)>0){Object(x.a)(".rev."+N(t[F-1])).attr("transform","translate(0,"+-U+")"),t[F-1].yRevBottom-=U,t[F-1].yRevTop-=U;break}l.call(f),Object(b.a)(".MainChart").call(Object(k.downloadable)())}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"MainVizComponent"},r.a.createElement("svg",{className:"MainChart",ref:function(e){return t.node=e},width:this.props.width,height:this.state.height}))}}]),e}(a.Component);T.defaultProps={};var S=n(159),W=n(160),C=n.n(W),Y=(n(183),n(235),function(t){var e=t.numPersons,n=Math.floor(Math.sqrt(e)),a=function(t,n,a,i){return r.a.createElement("g",{key:a*e+i,className:"person"},r.a.createElement("rect",{width:16,height:16,x:a,y:i,fill:"none"}),r.a.createElement("text",{textAnchor:"middle",alignmentBaseline:"middle",fill:"black",fontSize:16,x:a+8,y:i+9.6},function(t){switch(t){case"normal":return"\ud83d\ude42";case"mild":return"\ud83e\udd12";case"severe":return"\ud83e\udd22";case"dead":return"\ud83d\udc80";case"bedempty":return"\ud83d\udecf";case"bedful":return"\ud83d\udecc";default:return"\ud83d\ude42"}}(t)))};return r.a.createElement("svg",{className:"SimComponent",width:t.width,height:t.height},r.a.createElement("g",null,function(e){var r=[],i=.9*t.width;return e.People.forEach(function(t,e){t.forEach(function(t,o){var l=Math.random(),c="";c=t.infected?E(l>.8?2:1):E(0),r.push(a(c,"population",e/n*i,o/n*i))})}),r}(t.worldState)))}),_=n(81),B=function(t,e){var n,a={People:Object(_.a)(Array(t).keys()).map(function(e){return Object(_.a)(Array(t).keys()).map(function(t){return N({initX:e,initY:t})})}),infections:{infected:e,notInfected:t*t-e}};if(e){for(var r=[];r.length<e;){var i=(n=t*t,Math.floor(Math.random()*(n-0+1))+0);i in r||r.push(i)}console.log(r),r.forEach(function(e){return a.People[Math.floor(e/t)][e%t].infected=!0})}return a},A=function(t,e,n){t.People.length;var a=t.People,r=[];return a.forEach(function(t,i){r[i]=[],t.forEach(function(t,o){var l=L(a[i][o],a,e);r[i][o]=a[i][o].calcInfected(l,n,a[i][o].infectedDays)})}),t.infections={infected:0,notInfected:0},a.forEach(function(e,n){e.forEach(function(e,i){a[n][i].infected=r[n][i],r[n][i]?(t.infections.infected++,a[n][i].infectedDays++):t.infections.notInfected++})}),{People:a,infections:t.infections}},L=function(t,e,n){return{0:n[t.x][t.y][0].map(function(t){return e[t[0]][t[1]]})}},H=function(t){var e=t-1;return Object(_.a)(Array(t).keys()).map(function(n){return Object(_.a)(Array(t).keys()).map(function(t){return n<e&&t<e&&n>0&&t>0?{0:[[n-1,t-1],[n,t-1],[n+1,t-1],[n-1,t],[n+1,t],[n-1,t+1],[n,t+1],[n+1,t+1]]}:0===n&&0===t?{0:[[1,0],[1,1],[0,1]]}:0===n&&t===e?{0:[[0,e-1],[1,e-1],[1,e]]}:n===e&&0===t?{0:[[e-1,0],[e-1,1],[e,1]]}:n===e&&t===e?{0:[[e-1,e-1],[e-1,e],[e,e-1]]}:0===n?{0:[[n,t-1],[n+1,t-1],[n+1,t],[n,t+1],[n+1,t+1]]}:0===t?{0:[[n-1,t],[n+1,t],[n-1,t+1],[n,t+1],[n+1,t+1]]}:n===e?{0:[[n-1,t-1],[n,t-1],[n-1,t],[n-1,t+1],[n,t+1]]}:t===e?{0:[[n-1,t-1],[n,t-1],[n+1,t-1],[n-1,t],[n+1,t]]}:void 0})})},N=function(t){var e=t.initName,n=t.initX,a=t.initY,r=t.initHealth,i=t.initInfected,o=t.initImmune;return{name:e||"John",x:n||0,y:a||0,health:r||0,infected:i||!1,infectedDays:0,immunue:o||!1,calcInfected:function(t,e,n){var a=1;return Object.keys(t).forEach(function(n){var r=t[n].filter(function(t){return t.infected}).length;a*=Math.pow(1-.6/e*Math.pow(.9,n),r)}),0===n?Math.random()>a:!(n>=20)}}},z=function(t){function e(){var t;return Object(c.a)(this,e),(t=Object(u.a)(this,Object(d.a)(e).call(this))).handleTick=function(){t.setState({world:A(t.state.world,t.state.neighborAddresses,t.state.distancing)})},t.handleDistancing=function(e){t.setState({distancing:e?10:1})},t.handleReset=function(){t.setState({world:B(32,1)})},t.state=Object(l.a)({},t.props,{dimensions:{width:window.innerWidth,height:window.innerHeight},currentFilters:[],data:[],timeline:!0,revAsCircles:!1,distancing:10,neighborAddresses:H(32),world:B(32,1)}),t.updateDimensions=t.updateDimensions.bind(Object(h.a)(t)),t.handleTick=t.handleTick.bind(Object(h.a)(t)),t}return Object(f.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.updateDimensions),console.log("mounted")}},{key:"updateDimensions",value:function(){this.setState({dimensions:{height:window.innerHeight,width:window.innerWidth}})}},{key:"render",value:function(){for(var t=!!m.a.isEmpty(this.state.world),e=0;e<150;e++);return t?null:r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement("div",{className:"application"},r.a.createElement(S.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("meta",{name:"viewport",content:"width=1100,initial-scale=0.3,shrink-to-fit=yes"})))),r.a.createElement("div",{className:"uiWidgetContainer"},r.a.createElement("label",null,r.a.createElement("span",null,"COVID-19 Simulation"),r.a.createElement("br",null),r.a.createElement("button",{onClick:this.handleTick},"Next Day"),r.a.createElement("br",null),r.a.createElement("button",{onClick:this.handleReset},"Reset"),r.a.createElement("br",null),"Distancing ",r.a.createElement(C.a,{onChange:this.handleDistancing,checked:10===this.state.distancing}))),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("div",{className:"vizContainer"},r.a.createElement(Y,{width:700,height:700,numPersons:1024,worldState:this.state.world,distancing:this.state.distancing})))}}]),e}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[163,1,2]]]);
//# sourceMappingURL=main.6da28d83.chunk.js.map