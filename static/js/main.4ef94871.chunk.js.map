{"version":3,"sources":["data/gnpc_commodity_exports.csv","logo.svg","components/MainVizComponent/MainVizComponent.js","VizHelpers.js","components/SimComponent/SimComponent.js","Simulate.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","MainVizComponent","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","setHeightFromDateExtant","minDate","maxDate","setHeight","diff","length","createChart","bind","assertThisInitialized","state","height","console","log","setState","timeline","data","months","nextProps","_this$props","revAsCircles","margin","top","right","bottom","left","width","node","select","_","sortBy","forEach","d","yRevBottom","yRevTop","numFormat","format","yTimeLine","scaleLinear","range","yIndex","config","xOffset","yOffset","labelPositioning","alpha","spacing","leftTitle","rightTitle1","rightTitle2","leftSubTitle","rightSubTitle","labelGroupOffset","labelKeyOffset","radius","subTitleYShift","unfocusOpacity","revWidthMultiple","priceWidthMultiple","timelineWidthMultiple","smallConfig","maxwidth","color","highlightColor","border","volWidth","revBoxesPerCol","maxRevWidth","volTitle","priceTitle1","priceTitle2","revTitle1","revTitle2","tooltip","tip","attr","offset","direction","html","title","items","htmlBlock","i","label","value","makeTooltip","year","Lifting","Date_of_sale","Payment_receipt_date","Price","Volume","Revenue","Buyer","Destination","selectAll","remove","scaleSequential","interpolateReds","domain","timeParse","getY","yVal","index","moment","map","toDate","timeMonth","floor","add","subtract","ceil","append","axisLeft","tickValues","make_y_gridlines","tickSize","tickFormat","timeFormat","borderLines","slopeGroups","enter","id","sellDate","paymentDate","leftSlopeLabels","each","xLeftPosition","yLeftPosition","text","rightSlopeLabels","xRightPosition","yRightPosition","titles","priceBars","smallX","maxRev","max","circleX","Math","sqrt","makeClass","split","join","toLowerCase","volBars","revBars","on","show","hide","push","volData","round","currentBatch","j","boxWidth","returnVal","defaultX","defaultY","vCumulativeDelta","downloadable","_this2","react_default","a","createElement","className","ref","Component","defaultProps","SimComponent_SimComponent","numPersons","maxPerRow","calcFillInfected","infected","Person","location","x","y","key","fill","textAnchor","alignmentBaseline","fontSize","cellWidth","PersonEmoji","world","emojis","worldWidth","People","col","person","health","testPrint","worldState","newWorld","numInfected","maximum","toConsumableArray","Array","keys","makePerson","initX","initY","infections","notInfected","healthy","mildlySick","severelySick","dead","infectedPicks","newRand","random","pick","getNextStateOfWorld","currentState","neighborAddresses","distancing","newInfected","row","neighbors","getNeighborsForPerson","calcInfected","infectedDays","calcHealth","hospitalised","AllPeople","0","address","getAllNeighbors","l","properties","initName","initHealth","initInfected","initImmune","name","immune","probNotInfected","neighborTier","numNeighbors","filter","neighbor","pow","randNum","NOT_INF_MILD_RECOVER","NOT_INF_SEVERE_RECOVER_NO_HOSPITAL","NOT_INF_SEVERE_RECOVER_HOSPITAL","INF_MILD_SICK","INF_MILD_RECOVER","INF_SEVERE_RECOVER_NO_HOSPITAL","INF_SEVERE_RECOVER_HOSPITAL","App","handleTick","setInterval","handleDistancing","checked","handleReset","objectSpread2","dimensions","window","innerWidth","innerHeight","updateDimensions","addEventListener","isLoading","isEmpty","tick","Helmet","charSet","content","onClick","react_switch_default","onChange","Boolean","hostname","match","ReactDOM","render","src_App_0","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.4ef94871.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/gnpc_commodity_exports.97d62662.csv\";","module.exports = __webpack_public_path__ + \"static/media/logo.5d5d9eef.svg\";","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport styles from './MainVizComponent.scss'\nimport _ from 'lodash'\nimport { select, selectAll } from 'd3-selection'\nimport { scaleBand,scaleLinear,scaleQuantile,scaleSequential } from 'd3-scale'\nimport { interpolateReds } from 'd3-scale-chromatic'\nimport { axisBottom, axisLeft, axisRight } from 'd3-axis'\nimport { format } from 'd3-format'\nimport { default as tip } from 'd3-tip'\nimport { min, max } from 'd3-array'\nimport { timeMonth } from 'd3-time'\nimport { makeTooltip } from '../../VizHelpers'\nimport {downloadable} from 'd3-downloadable'\nimport { timeFormat, timeParse} from 'd3-time-format'\nimport * as moment from 'moment'\n\n\n\nclass MainVizComponent extends Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\tthis.createChart = this.createChart.bind(this)\n\t\tthis.state = {\n\t\t\theight: 4000\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tconsole.log(this.props);\n\n\t\tthis.setState({\n\t\t\theight: this.props.timeline \n\t\t\t\t? this.setHeightFromDateExtant(this.props.minDate,this.props.maxDate)\n\t\t\t\t: this.setHeight(this.props.data.length),\n      months: this.props.timeline ? this.props.maxDate.diff(this.props.minDate,'months') : 0\n    })\n\t\tthis.createChart()\n\t}\n\t\n\tcomponentDidUpdate() {\n\t\tthis.createChart()\n\t}\n\t\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (nextProps.data !== this.props.data || nextProps.timeline !== this.props.timeline) {\n\n\t\t\tthis.setState({\n\t\t\t\theight: nextProps.timeline \n\t\t\t\t\t? this.setHeightFromDateExtant(nextProps.minDate,nextProps.maxDate)\n          : this.setHeight(nextProps.data.length),\n        months: nextProps.timeline ? nextProps.maxDate.diff(nextProps.minDate,'months') : 0\n      })\n      \n\t\t}\n\t}\n\t\n\tsetHeightFromDateExtant = (minDate,maxDate) => this.setHeight(maxDate.diff(minDate,'months'));\n\tsetHeight = (length) => length * 180 + 500;\n\n\tcreateChart() {\n\t\tlet data = this.props.data ? this.props.data : [];\n\t// let timeline = this.props.timeline;\n\t\tlet {revAsCircles, timeline} = this.props;\n\t\tvar margin = {top: 150, right: 5, bottom: 5, left: this.props.width/3 },\n\t\twidth = this.props.width - margin.left - margin.right,\n\t\theight = this.state.height - margin.top - margin.bottom,\n\t\tnode = select(this.node);\n\n\t\tconsole.log(data);\n\t\tconsole.log(revAsCircles);\n\n\t\tdata = _.sortBy(data,\"Date_of_sale\")\n\t// const barHeight = 5;\n\t\tdata.forEach(d => {\n\t\t\td.yRevBottom = 0;\n\t\t\td.yRevTop = 0;\n\t\t})\n  \n    // var durationFormat = format(\".1f\");\n    var numFormat = format(',.2f');\n\n    var yTimeLine = scaleLinear()\n      .range([height, 0]);\n      \n    var yIndex = scaleLinear()\n      .range([height, 0]);\n\n\t\tvar config = {\n      xOffset: 0,\n      yOffset: 0,\n      // width: 150,\n      width: width/8,\n      height: height,\n      labelPositioning: {\n      alpha: 0.5,\n      spacing: 18\n      },\n      leftTitle: \"Lifting\",\n      rightTitle1: \"Buyer\",\n      rightTitle2: \"& Destination\",\n      leftSubTitle: \"Date of Sale\",\n      rightSubTitle: \"Payment Due Date\",\n      labelGroupOffset: 5,\n      labelKeyOffset: 50,\n        radius: 6,\n        subTitleYShift: 20,\n      // Reduce this to turn on detail-on-hover version\n        unfocusOpacity: 0.3,\n        revWidthMultiple: 3.5,\n      priceWidthMultiple: 1.5,\n      timelineWidthMultiple: 0.6\n\t\t}\n\t\t\n\t\tvar smallConfig = {\n\t\t\tmaxwidth: width/15 > 20 ? width/15 : 20,\n\t\t\theight: 10,\n\t\t\t// color: '#c59800',\n\t\t\tcolor: '#ecb600',\n\t\t\thighlightColor: '#CE1126',\n\t\t\tborder: '#eee',\n      volWidth: 2.5,\n      revBoxesPerCol: 10,\n\t\t\tmaxRevWidth: 400,\n\t\t\tvolTitle: \"Volume (barrels)\",\n\t\t\tpriceTitle1: \"Price\",\n\t\t\tpriceTitle2: \"(US$)\",\n\t\t\trevTitle1: \"Revenue\",\n\t\t\trevTitle2: \"(US$)\",\n\t\t}\n\n\t\tlet tooltip = tip()\n\t\t\t.attr('class', 'd3-tip')\n\t\t\t.offset([0, 20])\n\t\t\t.direction(d => revAsCircles ? 'e':'se')\n\t\t\t.html((d) => {\n\t\t\t\treturn makeTooltip(\n\t\t\t\t\td.year,\n\t\t\t\t\t[\n\t\t\t\t\t\t{label:\"Lifting\", value:d.Lifting},\n\t\t\t\t\t\t{label:\"Date of Sale\", value:d.Date_of_sale.format(\"D MMM YYYY\")},\n\t\t\t\t\t\t{label:\"Payment Receipt Date\", value:d.Payment_receipt_date.format(\"D MMM YYYY\")},\n\t\t\t\t\t\t{label:\"Price\", value:\"US$ \"+numFormat(d.Price)+\" per barrel\"},\n\t\t\t\t\t\t{label:\"Volume\", value:numFormat(d.Volume)+\" barrels\"},\n\t\t\t\t\t\t{label:\"Revenue\", value:\"US$ \"+numFormat(d.Revenue)},\n\t\t\t\t\t\t{label:\"Buyer\", value:d.Buyer},\n\t\t\t\t\t\t{label:\"Destination\", value:d.Destination}\n\t\t\t\t\t]\n\t\t\t\t)\n\t\t\t})\n\n\t\tnode.selectAll(\"g\").remove();\n\n\t\tvar colorScale = scaleSequential(interpolateReds)\n      .domain([0,10])\n\n    var parse = timeParse(\"%s\");\n\n    \n    // gridlines in y axis function\n    function make_y_gridlines(months,minDate,maxDate) {\t\t\n      console.log(minDate,maxDate)\n      console.log(timeMonth.range(minDate, maxDate).map(d => +d));\n      return axisLeft(yTimeLine)\n          .tickValues(timeMonth.range(minDate, maxDate).map(d => +d))\n          // .tickValues([1420041600000,1500000000000,1519833600000])\n    }\n\n\n    // \tvar getColor = function(cpue) {\n    // \t\tif (cpue) {\n    // \t\t\treturn colorScale(cpue);\n    // \t\t} else return \"#ccc\";\n    // }\n    \n    var getY = function(yVal,index) {\n      if (timeline) {\n        return yTimeLine(yVal);\n      } else {\n        return yIndex(index);\n      }\n\t}\n\n\t\t\t \n\t// Calculate y domain for ratios\n\tvar maxDate = moment(moment.max(data.map(d => d.Payment_receipt_date)).toDate());\n\tvar minDate = moment(moment.min(data.map(d => d.Date_of_sale)).toDate());\n\n\t\tyTimeLine.domain([timeMonth.floor(maxDate.add(2, 'months')), timeMonth.floor(minDate.subtract(1, 'months'))]);\n    yIndex.domain([data.length, -1]);\n    \n    \n\n    console.log(yTimeLine.domain());\n    console.log(timeMonth.range(timeMonth.floor(yTimeLine.domain()[0]), timeMonth.ceil(yTimeLine.domain()[1])));\n\n    if (timeline) {\n      // add the Y gridlines\n      node.append(\"g\")\t\t\t\n        .attr(\"class\", \"grid\")\n        .attr(\"transform\",\"translate(0,\" + margin.top + \")\")\n        .call(make_y_gridlines(this.state.months,yTimeLine.domain()[1],yTimeLine.domain()[0])\n            .tickSize(-width*2)\n            .tickFormat(function(d) {\n              return timeFormat(\"%b %Y\")(d);\n            })\n        )\n    }\n\n    node.selectAll('.grid text')\n      .attr(\"dy\", 20)\n      .attr(\"dx\", 10)\n\t\t\n\t\t\t\t\n\t\tvar borderLines = node.append(\"g\")\n\t\t\t\t.attr(\"class\", \"borderLines\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n\t\tborderLines.append(\"line\")\n\t\t\t.attr(\"x1\", 0).attr(\"y1\", 0)\n\t\t\t.attr(\"x2\", 0).attr(\"y2\", config.height);\n\t\tborderLines.append(\"line\")\n\t\t\t.attr(\"x1\", config.width*config.timelineWidthMultiple ).attr(\"y1\", 0)\n\t\t\t.attr(\"x2\", config.width*config.timelineWidthMultiple ).attr(\"y2\", config.height);\n\t\t\n\t\tvar slopeGroups = node.append(\"g\")\n\t\t\t.selectAll(\"g\")\n\t\t\t.data(data)\n\t\t\t.enter().append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n\t\t\t\t.attr(\"class\", \"slope-group\")\n\t\t\t\t.attr(\"id\", function(d, i) {\n\t\t\t\t\td.id = \"group\" + d.Lifting;\n\t\t\t\t\td.sellDate = d.Date_of_sale.toDate();\n\t\t\t\t\td.paymentDate = d.Payment_receipt_date.toDate();\n\t\t\t\t});\n\t\t\n\t\tvar slopeLines = slopeGroups.append(\"line\")\n\t\t\t.attr(\"class\", \"slope-line\")\n\t\t\t.attr(\"x1\", 0)\n\t\t\t.attr(\"y1\", function(d,i) {\n\t\t\t\treturn getY(d.sellDate,i);\n\t\t\t})\n\t\t\t.attr(\"x2\", config.width*config.timelineWidthMultiple)\n\t\t\t.attr(\"y2\", function(d,i) {\n\t\t\t\treturn getY(d.paymentDate,i);\n\t\t\t});\n\t\t\n\t\tvar leftSlopeCircle = slopeGroups.append(\"circle\")\n\t\t.attr(\"class\", function(d) { return \"circle\";})\n\t\t\t.attr(\"r\", config.radius)\n\t\t\t.attr(\"cy\", function(d,i) { return getY(d.sellDate,i);});\n\t\t\n\t\tvar leftSlopeLabels = slopeGroups.append(\"g\")\n\t\t\t.attr(\"class\", \"slope-label-left\")\n\t\t\t.each(function(d,i) {\n\t\t\t\td.xLeftPosition = -config.labelGroupOffset;\n\t\t\t\td.yLeftPosition = getY(d.sellDate,i);\n\t\t\t});\n\t\t\n\t\tleftSlopeLabels.append(\"text\")\n\t\t\t.attr(\"class\", \"label-figure-small\")\n\t\t\t.attr(\"x\", d => d.xLeftPosition)\n\t\t\t.attr(\"y\", d => d.yLeftPosition)\n\t\t\t.attr(\"dx\", -10)\n\t\t\t.attr(\"dy\", config.subTitleYShift)\n\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t.text(d => (d.Date_of_sale.format(\"D MMM YYYY\")));\n\t\t\n\t\tleftSlopeLabels.append(\"text\")\n\t\t\t.attr(\"class\", \"label-figure\")\n\t\t\t.attr(\"x\", d => d.xLeftPosition)\n\t\t\t.attr(\"y\", d => d.yLeftPosition)\n\t\t\t.attr(\"dx\", -10)\n\t\t\t.attr(\"dy\", 3)\n\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t.text(d => d.Lifting);\n\t\t\n\tvar rightSlopeCircle = slopeGroups.append(\"circle\")\n\t\t.attr(\"class\", function(d) { return \"circle\";})\n\t\t.attr(\"r\", config.radius)\n\t\t\t.attr(\"cx\", config.width*config.timelineWidthMultiple)\n\t\t\t.attr(\"cy\", function(d,i) { return getY(d.paymentDate,i);});\n\t\t\n\t\tvar rightSlopeLabels = slopeGroups.append(\"g\")\n\t\t\t.attr(\"class\", \"slope-label-right\")\n\t\t\t.each(function(d,i) {\n\t\t\t\td.xRightPosition = config.width*config.timelineWidthMultiple + config.labelGroupOffset;\n\t\t\t\td.yRightPosition = getY(d.paymentDate,i);\n\t\t\t});\n\t\t\n\t\trightSlopeLabels.append(\"text\")\n\t\t\t.attr(\"class\", \"label-figure-small\")\n\t\t\t.attr(\"x\", d => d.xRightPosition)\n\t\t\t.attr(\"y\", d => d.yRightPosition)\n\t\t\t.attr(\"dx\", 10)\n\t\t\t.attr(\"dy\", 2*config.subTitleYShift)\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t.text(d => (d.Payment_receipt_date.format(\"D MMM YYYY\")));\n\t\t\n\t\trightSlopeLabels.append(\"text\")\n\t\t\t.attr(\"class\", \"label-figure\")\n\t\t\t.attr(\"x\", d => d.xRightPosition)\n\t\t\t.attr(\"y\", d => d.yRightPosition)\n\t\t\t.attr(\"dx\", 10)\n\t\t\t.attr(\"dy\", 3)\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t.text(d => d.Buyer);\n\t\t\n\trightSlopeLabels.append(\"text\")\n\t\t\t.attr(\"class\", \"label-figure\")\n\t\t\t.attr(\"x\", d => d.xRightPosition)\n\t\t\t.attr(\"y\", d => d.yRightPosition)\n\t\t\t.attr(\"dx\", 10)\n\t\t\t.attr(\"dy\", 3+config.subTitleYShift)\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t.text(d => d.Destination);\n\t\t\n\t\tvar titles = node.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(\" + 0 + \",\" + margin.top + \")\")\n\t\t\t.attr(\"class\", \"title\");\n\t\t\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t.attr(\"x\", margin.left)\n\t\t\t.attr(\"dx\", -10)\n\t\t\t.attr(\"dy\", -margin.top / 4)\n\t\t\t.text(config.leftTitle);\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"text-anchor\", \"end\")\n\t\t\t.attr(\"class\", \"label-figure-small\")\n\t\t\t.attr(\"x\", margin.left)\n\t\t\t.attr(\"dx\", -10)\n\t\t\t.attr(\"dy\", -margin.top / 4 + config.subTitleYShift)\n\t\t\t.text(config.leftSubTitle);\n\t\t\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"x\", margin.left + config.width*config.timelineWidthMultiple)\n\t\t\t.attr(\"dx\", 10)\n\t\t\t.attr(\"dy\", -margin.top / 4)\n\t\t.text(config.rightTitle1);\n\ttitles.append(\"text\")\n\t\t\t.attr(\"x\", margin.left + config.width*config.timelineWidthMultiple)\n\t\t\t.attr(\"dx\", 10)\n\t\t\t.attr(\"dy\", -margin.top / 4 + config.subTitleYShift)\n\t\t\t.text(config.rightTitle2);\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"class\", \"label-figure-small\")\n\t\t\t.attr(\"x\", margin.left + config.width*config.timelineWidthMultiple)\n\t\t\t.attr(\"dx\", 10)\n\t\t\t.attr(\"dy\", -margin.top / 4 + 2*config.subTitleYShift)\n\t\t\t.text(config.rightSubTitle);\n\n\n\n\t\tvar priceBars = node.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(\" + (margin.left + config.width) + \",\" + margin.top + \")\")\n\t\t\t.attr(\"class\", \"price\");\n\n\t\tvar smallX = scaleLinear()\n\t\t\t.range([0, smallConfig.maxwidth])\n\t\t.domain([0,100]); \n\t\t\n\tvar maxRev = max(data.map(d => d.Revenue))\n\tvar circleX = scaleLinear()\n\t\t\t.range([0, config.width])\n\t\t\t.domain([0,Math.sqrt(maxRev)]); \n\n\t\tfunction makeClass(d) {\n\t\t\treturn d.Lifting.split(\" \").join(\"\").toLowerCase();\n\t\t} \n\n\tvar volBars = [];\n\t\tvar revBars = [];\n\t\tvar annotations = [];\n\n\t\tpriceBars.selectAll(\".bar\")\n\t\t.data(data)\n\t.enter().append(\"rect\")\n\t\t.attr(\"class\", function(d) { return \"bar price \" + makeClass(d);})\n\t\t.attr(\"x\", function(d) { return config.width*config.priceWidthMultiple; })\n\t\t.attr(\"width\", function(d) { return smallX(+d.Price) })\n\t\t.attr(\"y\", function(d,i) { return d.yRightPosition - smallConfig.height/2; })\n\t\t.attr(\"fill\", function(d) { return smallConfig.color; })\n\t\t.attr(\"stroke\", function(d) { return smallConfig.border; })\n\t\t\t.attr(\"height\", function(d) { return smallConfig.height; })\n\t\t\t.on('mouseover', function(d) {\n\t\ttooltip.show(d,this);\n\t\tselectAll(\".\"+makeClass(d))\n\t\t\t\t\t.attr(\"fill\", smallConfig.highlightColor);\n\t\t\t\t\t\n\t\t\t\tselectAll(\".annote.\"+ makeClass(d))\n\t\t\t\t\t.attr(\"display\", \"block\")\n\t\t\t})\n\t\t\t.on('mouseout', function(d) {\n\t\ttooltip.hide();\n\t\tselectAll(\".\"+makeClass(d))\n\t\t\t\t\t.attr(\"fill\", smallConfig.color);\n\t\t\t\t\t\n\t\t\t\tselectAll(\".annote.\"+ makeClass(d))\n\t\t\t\t\t.attr(\"display\", \"none\")\n\t\t})\n\n\t\tif (revAsCircles) {\n\t\trevBars.push(node.append(\"g\")\n\t\t\t.attr(\"transform\", \"translate(\" + (margin.left + config.width*config.revWidthMultiple) + \",\" + margin.top + \")\")\n\t\t\t.attr(\"class\", function(d) { return \"rev\";}));\n\t\t\t\n\t\trevBars[0].selectAll(\".bar\")\n\t\t\t.data(data)\n\t\t.enter().append(\"circle\")\n\t\t\t.attr(\"class\", function(d) { return \"bar rev \" + makeClass(d);})\n\t\t\t.attr(\"cx\", function(d) { \n\t\t\treturn config.width;\n\t\t\t})\n\t\t\t.attr(\"r\", function(d) { return circleX(Math.sqrt(+d.Revenue)) })\n\t\t\t.attr(\"cy\", function(d) { \n\n\t\t\tvar returnVal = d.yRightPosition;\n\t\t\t\n\t\t\treturn returnVal; \n\t\t\t})\n\t\t\t.attr(\"fill\", function(d) { return smallConfig.color; })\n\t\t\t.attr(\"stroke\", function(d) { return smallConfig.border; })\n\t\t\t// .attr(\"height\", function(d) { return smallConfig.height; })\n\t\t\t.on('mouseover', function(d) {\n\t\t\ttooltip.show(d,this);\n\t\t\tselectAll(\".\"+makeClass(d))\n\t\t\t\t.attr(\"fill\", smallConfig.highlightColor);\n\t\t\tselectAll(\".annote.\"+ makeClass(d))\n\t\t\t\t.attr(\"display\", \"block\")\n\t\t\t})\n\t\t\t.on('mouseout', function(d) {\n\t\t\ttooltip.hide();\n\t\t\tselectAll(\".\"+makeClass(d))\n\t\t\t\t.attr(\"fill\", smallConfig.color);\n\t\t\tselectAll(\".annote.\"+ makeClass(d))\n\t\t\t\t.attr(\"display\", \"none\")\n\t\t\t})\n\t\t} \n\t\t\t\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t.attr(\"x\", margin.left + config.width*(config.priceWidthMultiple+1))\n\t\t\t.attr(\"dx\", -10)\n\t\t\t.attr(\"dy\", -margin.top / 4)\n\t\t\t.text(smallConfig.priceTitle1);\n\ttitles.append(\"text\")\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t.attr(\"x\", margin.left + config.width*(config.priceWidthMultiple+1))\n\t\t.attr(\"dx\", -10)\n\t\t.attr(\"dy\", -margin.top / 4 + config.subTitleYShift)\n\t\t.text(smallConfig.priceTitle2);\n\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t.attr(\"x\", 0)\n\t\t\t.attr(\"dx\", 0)\n\t\t\t.attr(\"dy\", -margin.top / 4)\n\t\t\t.text(smallConfig.volTitle);\n\n\t\ttitles.append(\"text\")\n\t\t\t.attr(\"text-anchor\", \"start\")\n\t\t\t.attr(\"x\", margin.left + config.width*config.revWidthMultiple)\n\t\t\t.attr(\"dx\", 0)\n\t\t\t.attr(\"dy\", -margin.top / 4)\n\t\t\t.text(smallConfig.revTitle1);\n\ttitles.append(\"text\")\n\t\t.attr(\"x\", margin.left + config.width*config.revWidthMultiple)\n\t\t.attr(\"dx\", 0)\n\t\t.attr(\"dy\", -margin.top / 4 + config.subTitleYShift)\n\t\t.text(smallConfig.revTitle2);\n\n\t\tvar volData = data.map(function(d) {\n\t\t\treturn _.range(0,Math.round(d.Volume/10000))\n\t\t})\n\n\n\t\t// console.log(volData);\n\n\t\t\n\t\tdata.forEach(function(currentBatch,i) {\n\t\t\tvolBars.push(node.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + 10 + \",\" + margin.top + \")\")\n\t\t\t\t.attr(\"class\", function(d) { return \"volume\";}))\n\n\t\t\trevBars.push(node.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + (margin.left + config.width*config.revWidthMultiple) + \",\" + margin.top + \")\")\n\t\t\t\t.attr(\"class\", function(d) { return \"rev\";}));\n\n\t\t\t// console.log(volBars);\n\n\t\t\tvolBars[i].selectAll(\".bar\")\n\t\t\t\t.data(volData[i])\n\t\t\t.enter().append(\"rect\")\n\t\t\t.attr(\"class\", function(d) { return \"bar vol \" + makeClass(currentBatch);})\n\t\t\t\t.attr(\"x\", function(d,j) { return smallConfig.volWidth*j; })\n\t\t\t\t.attr(\"width\", function(d) { return smallConfig.volWidth })\n\t\t\t\t.attr(\"y\", function(d,j) { return currentBatch.yLeftPosition - smallConfig.height/2; })\n\t\t\t\t.attr(\"fill\", function(d) { return smallConfig.color; })\n\t\t\t\t.attr(\"stroke\", function(d) { return smallConfig.border; })\n\t\t\t\t.attr(\"height\", function(d) { return smallConfig.height; })\n\t\t\t\t.on('mouseover', function(d) {\n\t\t\t\t\ttooltip.show(currentBatch,this);\n\t\t\t\t\tselectAll(\".\"+makeClass(currentBatch))\n\t\t\t\t\t\t.attr(\"fill\", smallConfig.highlightColor);\n\t\t\t\t\t\n\t\t\t\t\tselectAll(\".annote.\"+ makeClass(currentBatch))\n\t\t\t\t\t\t.attr(\"display\", \"block\")\n\t\t\t\t})\n\t\t\t\t.on('mouseout', function(d) {\n\t\t\t\t\ttooltip.hide();\n\t\t\t\t\tselectAll(\".\"+makeClass(currentBatch))\n\t\t\t\t\t\t.attr(\"fill\", smallConfig.color);\n\t\t\t\t\t\n\t\t\t\t\tselectAll(\".annote.\"+ makeClass(currentBatch))\n\t\t\t\t\t\t.attr(\"display\", \"none\")\n\t\t\t\t})\n\n\t\tif (!revAsCircles) {\n\t\trevBars[i].selectAll(\".bar\")\n\t\t\t.data(volData[i])\n\t\t.enter().append(\"rect\")\n\t\t\t.attr(\"class\", function(d) { return \"bar rev \" + makeClass(currentBatch);})\n\t\t\t.attr(\"x\", function(d,j) { \n\t\t\tvar boxWidth = smallX(+currentBatch.Price)\n\t\t\t// var boxesPerRow = Math.floor(smallConfig.maxRevWidth/boxWidth);\n\t\t\tvar index = Math.floor(j / smallConfig.revBoxesPerCol);\n\t\t\treturn index*boxWidth;\n\t\t\t\n\n\t\t\t})\n\t\t\t.attr(\"width\", function(d) { return smallX(+currentBatch.Price) })\n\t\t\t.attr(\"y\", function(d,j) { \n\t\t\t// var boxWidth = smallX(+currentBatch.Price)\n\t\t\t// var boxesPerRow = Math.floor(smallConfig.maxRevWidth/boxWidth);\n\t\t\t// var row = Math.floor(j/boxesPerRow);\n\n\t\t\t// data[i].yRevBottom = data[i].yRevBottom > returnVal + smallConfig.height \n\t\t\t// \t? data[i].yRevBottom\n\t\t\t// \t: returnVal + smallConfig.height;\n\t\t\t\n\t\t\tvar index = j % smallConfig.revBoxesPerCol;\n\t\t\tvar returnVal = currentBatch.yRightPosition - smallConfig.height/2 + (smallConfig.height*index);\n\t\t\t\n\t\t\tdata[i].yRevBottom = data[i].yRevBottom > returnVal + smallConfig.height \n\t\t\t\t? data[i].yRevBottom\n\t\t\t\t: returnVal + smallConfig.height;\n\t\t\t\n\t\t\treturn returnVal; \n\t\t\t})\n\t\t\t.attr(\"fill\", function(d) { return smallConfig.color; })\n\t\t\t.attr(\"stroke\", function(d) { return smallConfig.border; })\n\t\t\t.attr(\"height\", function(d) { return smallConfig.height; })\n\t\t\t.on('mouseover', function(d) {\n\t\t\ttooltip.show(currentBatch,this);\n\t\t\tselectAll(\".\"+makeClass(currentBatch))\n\t\t\t\t.attr(\"fill\", smallConfig.highlightColor);\n\t\t\tselectAll(\".annote.\"+ makeClass(currentBatch))\n\t\t\t\t.attr(\"display\", \"block\")\n\t\t\t})\n\t\t\t.on('mouseout', function(d) {\n\t\t\ttooltip.hide();\n\t\t\tselectAll(\".\"+makeClass(currentBatch))\n\t\t\t\t.attr(\"fill\", smallConfig.color);\n\t\t\tselectAll(\".annote.\"+ makeClass(currentBatch))\n\t\t\t\t.attr(\"display\", \"none\")\n\t\t\t})\n\t\t}\n\t\t\t\n\n\t\t\t// Volume Annotation\n\t\t\tnode.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + 0 + \",\" + margin.top + \")\")\n\t\t\t\t.append(\"text\")\n\t\t\t\t.attr(\"text-anchor\", \"left\")\n\t\t\t\t.attr(\"class\", function(d) { return \"annote vol \" + makeClass(currentBatch);})\n\t\t\t\t.attr(\"x\", 10)\n\t\t\t\t.attr(\"dx\", 0)\n\t\t\t\t.attr(\"y\", currentBatch.yLeftPosition - 10)\n\t\t\t\t.attr(\"fill\", smallConfig.color)\n\t\t\t\t.attr(\"display\", \"none\")\n\t\t\t\t.text(numFormat(currentBatch.Volume)+\" barrels\")\n\n\t\t\t// Price Annotation\n\t\t\tnode.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + 0 + \",\" + margin.top + \")\")\n\t\t\t\t.append(\"text\")\n\t\t\t\t.attr(\"text-anchor\", \"middle\")\n\t\t\t\t.attr(\"class\", function(d) { return \"annote price \" + makeClass(currentBatch);})\n\t\t\t\t.attr(\"x\", margin.left + config.width*(config.priceWidthMultiple+1.25))\n\t\t\t\t.attr(\"dx\", 0)\n\t\t\t\t.attr(\"y\", currentBatch.yRightPosition)\n\t\t\t\t.attr(\"dy\", -10)\n\t\t\t\t.attr(\"fill\", smallConfig.color)\n\t\t\t\t.attr(\"display\", \"none\")\n\t\t\t\t.text(\"US$ \"+numFormat(currentBatch.Price)+\" per barrel\")\n\n\t\t\t// Revenue Annotation\n\t\t\tnode.append(\"g\")\n\t\t\t\t.attr(\"transform\", \"translate(\" + 0 + \",\" + margin.top + \")\")\n\t\t\t\t.append(\"text\")\n\t\t\t\t.attr(\"text-anchor\", \"left\")\n\t\t\t\t.attr(\"class\", function(d) { return \"annote rev \" + makeClass(currentBatch);})\n\t\t\t\t.attr(\"x\", function() {\n\t\t\tvar defaultX = margin.left + config.width*(config.revWidthMultiple+.5);\n\t\t\treturn revAsCircles ? defaultX - config.width: defaultX;\n\t\t})\n\t\t\t\t.attr(\"dx\", 0)\n\t\t\t\t// .attr(\"y\", currentBatch.yRightPosition - 10)\n\t\t\t\t.attr(\"y\", function(d) { \n\t\t\tdata[i].yRevTop = currentBatch.yRightPosition - 30;\n\t\t\tvar defaultY = currentBatch.yRightPosition-10;\n\t\t\treturn revAsCircles ? defaultY - config.width : defaultY;\n\t\t\t\t})\n\t\t\t\t.attr(\"fill\", smallConfig.color)\n\t\t\t\t.attr(\"display\", \"none\")\n\t\t\t\t.text(\"US$ \"+numFormat(currentBatch.Revenue) + \" in revenue \") \n\t\t\t\t\t// + numFormat(data[i].yRevTop) + \" \" + numFormat(data[i].yRevBottom) )\n\t\t\t\n\t\t})\n\n\t\tconsole.log(data);\n\n\t\t// Adjust Rev Blocks so they don't overlap\n\t\t// Start from the bottom and keep pushing all the ones at the top up a bit untill\n\t\t// they no longer overlap\n\tvar vCumulativeDelta = 0;\n\n\t\tfor (var j = data.length-1; j > 0; j--) {\n\t\t\tfor (var i = data.length-1; i > 0; i--) {\n\t\t\n\t\tvCumulativeDelta =  data[i-1].yRevBottom > data[i].yRevTop\n\t\t\t? (data[i-1].yRevBottom-data[i].yRevTop)\n\t\t\t: 0;\n\n\t\tif (vCumulativeDelta > 0) {\n\t\t\tselectAll(\".rev.\" + makeClass(data[i-1]))\n\t\t\t.attr(\"transform\", \"translate(\" + 0 + \",\" + (-vCumulativeDelta) + \")\")\n\t\t\t\n\t\t\tdata[i-1].yRevBottom -= vCumulativeDelta;\n\t\t\tdata[i-1].yRevTop -= vCumulativeDelta;\n\t\t\tbreak;\n\t\t}\n\t\t\t}\n\t\t}\n\n\t\tnode.call(tooltip);\n\t\tselect('.MainChart')\n\t\t\t.call(downloadable());\n\n\t}\n\t\n\t\n\trender() {\n\t\t// let data = this.props.data ? this.props.data : [];\n\n\t\treturn (\n\t\t\t<div className=\"MainVizComponent\">\n\t\t\t\t<svg className=\"MainChart\" ref={node => this.node = node}\n\t\t\t\twidth={this.props.width} height={this.state.height}>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nMainVizComponent.propTypes = {}\n\nMainVizComponent.defaultProps = {}\n\nexport default MainVizComponent\n","export const makeTooltip = (title,items) => {\n  let htmlBlock = \"<div class='tootltip' style='font-size:12px; border: 1px solid #ccc; background-color: rgba(255,255,255,0.9); padding:5px; max-width:350px; z-index:2000'>\"\n  htmlBlock += title ? \"<div style='font-size:20px'>\" + title + \"</div>\" : '';\n  if (items)\n    items.forEach(i => {\n      htmlBlock += (\"<br/><strong>\"+i.label+\":</strong> \")\n      htmlBlock += (\"<div class='tootltip-value' style='font-size:18px;'>\"+i.value+\"</div>\")\n    })\n  htmlBlock += '</div>';\n  return htmlBlock;\n}\n\nexport const PersonEmoji = (state) => {\n  switch(state) {\n    case \"normal\":\n      return \"ðŸ™‚\";\n\n    case \"mild\":\n      return \"ðŸ¤’\";\n\n    case \"severe\":\n      return \"ðŸ¤¢\";\n\n    case \"dead\":\n      return \"ðŸ’€\";\n\n    case \"bedempty\":\n      return \"ðŸ›\";\n\n    case \"bedful\":\n      return \"ðŸ›Œ\";\n    \n    default:\n      return \"ðŸ™‚\";\n  }\n}\n\nexport const condition = (num) => {\n  return [\"normal\",\"mild\",\"severe\",\"dead\"][num];\n}\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styles from './SimComponent.scss'\nimport {PersonEmoji,condition} from '../../VizHelpers';\nimport { stackOffsetNone } from 'd3';\n\n\nexport default (props) => {\n\nconst numPersons = props.numPersons;\nconst maxPerRow = Math.floor(Math.sqrt(numPersons));\nconst cellWidth = 16;\nconst d_0 = 0.9;\n\nconst testPrint = (world) => {\n  // console.log(props);\n  let emojis = [];\n  // [...Array(numPersons).keys()].forEach(i => {\n  //   const drawLot = Math.random()\n  //   let state = \"\"\n  //   if (drawLot > 0.4) state = condition(0)\n  //   else if (drawLot > 0.1) state = condition(1)\n  //   else state = condition(2)\n  //   emojis.push(Person(state,\"population\",Math.floor(i/maxPerRow)/maxPerRow*props.width,(i%maxPerRow)/maxPerRow*props.width))\n  // })\n  const worldWidth = props.width*d_0;\n\n  world.People.forEach((col,x) => {\n    col.forEach((person,y) => {\n      // const drawLot = Math.random()\n      // console.log(person);\n      // let state = \"\";\n      // if (person.infected) {\n      //   if (drawLot > 0.97) state = condition(3);\n      //   else if (drawLot > 0.8) state = condition(2);\n      //   else if (drawLot > 0.2) state = condition(1);\n      //   else state = condition(0);\n      // } else {\n      //   state = condition(0);\n      // }\n      // person.health = person.calcHealth(person.infected,person.infectedDays,person.health,person.hospitalised);\n      const state = condition(person.health);\n\n      emojis.push(Person(state,person.infected,\"population\",x/maxPerRow*worldWidth,y/maxPerRow*worldWidth));\n    })\n  })\n\n  return emojis;\n  // ðŸ›ŒðŸ›ðŸ¤¢ðŸ’€ðŸ¤’\n}\n\nconst calcFillInfected = (infected) => {\n  return infected ? \"rgba(180,0,0,0.5)\" : \"none\";\n}\n\nconst Person = (state,infected,location,x,y) => {\n  // console.log(x,y);\n  \n  return <g key={x*numPersons+y} className=\"person\">\n    {/* <rect width=\"10\" height=\"110\" style=\"fill:rgb(0,0,0);stroke-width:1;stroke:rgb(0,0,0)\" /> */}\n    <rect width={cellWidth} height={cellWidth} x={x} y={y} fill={calcFillInfected(infected)}/>\n    <text\n      textAnchor=\"middle\"\n      alignmentBaseline=\"middle\"\n      fill=\"black\"\n      fontSize={cellWidth}\n      x={x+cellWidth/2}\n      y={y+cellWidth*1.2/2}\n    >\n      {PersonEmoji(state)}\n    </text>\n  </g>\n}\n\nreturn (\n  <svg className=\"SimComponent\" width={props.width} height={props.height}>\n    <g>\n      {testPrint(props.worldState)}\n    </g>\n  </svg>\n);\n}\n// SimComponent.propTypes = {}\n\n// SimComponent.defaultProps = {}\n\n\n","import { cloneElement } from \"react\";\n\nexport const PROB_INFECTION = 0.6;\nexport const PROB_INFECTION_DECAY = 0.9;\nexport const INCUBATION_PERIOD = 20;\n\nexport const NOT_INF_MILD_SICK = 0.05;\nexport const NOT_INF_SEVERE_SICK = 0.002;\nexport const NOT_INF_MILD_RECOVER = 0.9;\nexport const NOT_INF_MILD_TO_SEVERE = 0.1;\nexport const NOT_INF_SEVERE_RECOVER_NO_HOSPITAL = 0.85;\nexport const NOT_INF_SEVERE_CONTINUE_NO_HOSPITAL = 0.13;\nexport const NOT_INF_SEVERE_RECOVER_HOSPITAL = 0.97;\nexport const NOT_INF_SEVERE_CONTINUE_HOSPITAL = 0.02;\n\nexport const INF_MILD_SICK = 0.8;\nexport const INF_SEVERE_SICK = 0.2;\nexport const INF_MILD_RECOVER = 0.9;\nexport const INF_MILD_TO_SEVERE = 0.1;\nexport const INF_SEVERE_RECOVER_NO_HOSPITAL = 0.58;\nexport const INF_SEVERE_CONTINUE_NO_HOSPITAL = 0.4;\nexport const INF_SEVERE_RECOVER_HOSPITAL = 0.9;\nexport const INF_SEVERE_CONTINUE_HOSPITAL = 0.09;\n\n\nexport const randInt = (maximum) =>  Math.floor(Math.random() * (maximum - 0 + 1)) + 0;\n\nexport const newWorld = (width,numInfected) => {\n\tconst world = {\n\t\tPeople: [...Array(width).keys()].map(x =>\n\t\t\t\t[...Array(width).keys()].map(y => {\n\t\t\t\t\treturn makePerson({initX:x,initY:y})\n\t\t\t\t})\n\t\t\t),\n\t\tinfections: {infected: numInfected, notInfected: width*width-numInfected},\n\t\thealth: {healthy: width*width, mildlySick: 0, severelySick: 0, dead: 0}\n\t}\n\t\n\tif (numInfected) {\n\t\tlet infectedPicks = [];\n\t\twhile (infectedPicks.length < numInfected) {\n\t\t\tconst newRand = randInt(width*width)\n\t\t\tif (!(newRand in infectedPicks)) {\n\t\t\t\tinfectedPicks.push(newRand);\n\t\t\t}\n\t\t}\n\t\tconsole.log(infectedPicks);\n\t\tinfectedPicks.forEach(pick => world.People[Math.floor(pick/width)][pick%width].infected = true);\n\t}\n\treturn world;\n}\n\nexport const getNextStateOfWorld = (currentState,neighborAddresses,distancing) => {\n\t// currentState is an object consisting of\n\t// People: list of list of Persons, i.e. Persons[x][y] gives you the person at x,y\n\t// \n\n\tconst width = currentState.People.length;\n\tconst People = currentState.People;\n\n\t// console.log(People);\n\tconst newInfected = [];\n\n\tPeople.forEach((col,x) => {\n\t\tnewInfected[x] = [];\n\t\tcol.forEach((row,y) => {\n\t\t\tconst neighbors = getNeighborsForPerson(People[x][y],People,neighborAddresses);\n\t\t\t// console.log(neighbors);\n\t\t\tnewInfected[x][y] = People[x][y].calcInfected(neighbors,distancing,People[x][y].infectedDays);\n\t\t})\n\t})\n\n\t// console.log(newInfected);\n\n\tcurrentState.infections = {infected:0,notInfected:0};\n\tcurrentState.health = {healthy:0,mildlySick:0,severelySick:0,dead:0};\n\tPeople.forEach((col,x) => {\n\t\tcol.forEach((row,y) => {\n\t\t\tPeople[x][y].infected = newInfected[x][y];\n\t\t\tif (newInfected[x][y]) { \n\t\t\t\tcurrentState.infections.infected++;\n\t\t\t\tPeople[x][y].infectedDays++;\n\t\t\t}\n\t\t\telse currentState.infections.notInfected++;\n\n\t\t\t// if (People[x][y].health === 0) currentState.health.healthy--;\n\t\t\t// else if (People[x][y].health === 1) currentState.health.mildlySick--;\n\t\t\t// else if (People[x][y].health === 2) currentState.health.severelySick--;\n\t\t\t// else if (People[x][y].health === 3) currentState.health.dead--;\n\n\t\t\tPeople[x][y].health = People[x][y].calcHealth(People[x][y].infected,People[x][y].infectedDays,People[x][y].health,People[x][y].hospitalised);\n\n\t\t\tif (People[x][y].health === 0) currentState.health.healthy++;\n\t\t\telse if (People[x][y].health === 1) currentState.health.mildlySick++;\n\t\t\telse if (People[x][y].health === 2) currentState.health.severelySick++;\n\t\t\telse if (People[x][y].health === 3) currentState.health.dead++;\n\t\t})\n\t})\n\n\treturn {People:People,infections:currentState.infections,health:currentState.health}\n}\n\nexport const getNeighborsForPerson = (person,AllPeople,neighborAddresses) => {\n\t// console.log(person);\n\t// console.log(neighborAddresses);\n\treturn {\n\t\t0: neighborAddresses[person.x][person.y][0].map(address => {\n\t\t\t\treturn AllPeople[address[0]][address[1]];\n\t\t\t})\n\t};\n}\n\nexport const getAllNeighbors = (width) => {\n\tconst l = width-1; // last index\n\treturn [...Array(width).keys()].map(x =>\n\t\t[...Array(width).keys()].map(y => {\n\t\t\tif (x < l && y < l && x > 0 && y > 0 ) return {0:[[x-1,y-1],[x,y-1],[x+1,y-1],[x-1,y],[x+1,y],[x-1,y+1],[x,y+1],[x+1,y+1]]};\n\t\t\tif (x === 0 && y === 0) return {0:[[1,0],[1,1],[0,1]]};  \n\t\t\tif (x === 0 && y === l) return {0:[[0,l-1],[1,l-1],[1,l]]};  \n\t\t\tif (x === l && y === 0) return {0:[[l-1,0],[l-1,1],[l,1]]};  \n\t\t\tif (x === l && y === l) return {0:[[l-1,l-1],[l-1,l],[l,l-1]]};  \n\t\t\tif (x === 0) return {0:[[x,y-1],[x+1,y-1],[x+1,y],[x,y+1],[x+1,y+1]]};\n\t\t\tif (y === 0) return {0:[[x-1,y],[x+1,y],[x-1,y+1],[x,y+1],[x+1,y+1]]};\n\t\t\tif (x === l) return {0:[[x-1,y-1],[x,y-1],[x-1,y],[x-1,y+1],[x,y+1]]};\n\t\t\tif (y === l) return {0:[[x-1,y-1],[x,y-1],[x+1,y-1],[x-1,y],[x+1,y]]};\n\t\t})\n\t)\n\t// return neighborsByCoords;\n}\n\nexport const makePerson = (properties) => {\n\tconst {initName,initX,initY,initHealth,initInfected,initImmune} = properties;\n\t\n\tconst name = initName ? initName : \"John\";\n\t\n\t// health indicates whether person is normal, showing mild symptons, severe symptoms, or dead\n\tconst health = initHealth? initHealth : 0;\n\t\n\t// infected is a boolean indicating whether person is infected \n\tconst infected = initInfected ? initInfected : false;\n\t\n\t// immune is a boolean indicating whether person is immune \n\tconst immune = initImmune ? initImmune : false;\n\n\tconst x = initX ? initX : 0;\n\tconst y = initY ? initY : 0;\n\n\treturn {\n\t\tname: name,\n\t\tx: x,\n\t\ty: y,\n\t\thealth: health,\n\t\tinfected: infected,\n\t\thospitalised: false,\n\t\tinfectedDays: 0,\n\t\timmune: immune,\n\t\tcalcInfected: (neighbors,distancing,infectedDays) => {\n\t\t\t// neighbors is an object with different tiers of neighbors lists 0 is closest, 1 is next closest, etc\n\t\t\t// distancing is a constant >= 1\n\n\t\t\t// console.log(neighbors);\n\t\t\tlet probNotInfected = 1;\n\t\t\tObject.keys(neighbors).forEach(neighborTier => {\n\t\t\t\tconst numNeighbors = neighbors[neighborTier].filter(neighbor => neighbor.infected).length;\n\t\t\t\t// console.log(numNeighbors);\n\t\t\t\tprobNotInfected = probNotInfected \n\t\t\t\t\t* Math.pow( 1- (PROB_INFECTION / distancing * Math.pow(PROB_INFECTION_DECAY,neighborTier)) , numNeighbors )\n\t\t\t})\n\n\t\t\t// console.log(name + \"'s chance of getting infected = \" + (1-probNotInfected));\n\n\t\t\tif (infectedDays === 0) return Math.random() > probNotInfected;\n\t\t\telse if (infectedDays >= INCUBATION_PERIOD) return false;\n\t\t\telse return true;\n\t\t},\n\t\tcalcHealth: (infected,infectedDays,health,hospitalised) => {\n\t\t\t// if not infected, there's still a chance of getting sick\n\t\t\tconst randNum = Math.random();\n\t\t\tif (!infected) {\n\t\t\t\tif (health === 0) {\n\t\t\t\t\tif (randNum < NOT_INF_MILD_SICK) return 1;\n\t\t\t\t\telse if (randNum < NOT_INF_MILD_SICK + NOT_INF_SEVERE_SICK) return 2;\n\t\t\t\t\telse return 0;\n\t\t\t\t} else if (health === 1) {\n\t\t\t\t\tif (randNum < NOT_INF_MILD_RECOVER) return 0;\n\t\t\t\t\telse if (randNum < NOT_INF_MILD_RECOVER + NOT_INF_MILD_TO_SEVERE) return 2;\n\t\t\t\t\telse return 1;\n\t\t\t\t} else if (health === 2 && !hospitalised) {\n\t\t\t\t\tif (randNum < NOT_INF_SEVERE_RECOVER_NO_HOSPITAL) return 0;\n\t\t\t\t\tif (randNum < NOT_INF_SEVERE_RECOVER_NO_HOSPITAL + NOT_INF_SEVERE_CONTINUE_NO_HOSPITAL) return 2;\n\t\t\t\t\telse return 3;\n\t\t\t\t} else if (health === 2 && hospitalised) {\n\t\t\t\t\tif (randNum < NOT_INF_SEVERE_RECOVER_HOSPITAL) return 0;\n\t\t\t\t\tif (randNum < NOT_INF_SEVERE_RECOVER_HOSPITAL + NOT_INF_SEVERE_CONTINUE_HOSPITAL) return 2;\n\t\t\t\t\telse return 3;\n\t\t\t\t} else if (health === 3) return 3;\n\t\t\t}\n\n\t\t\t// if infected\n\t\t\tif (infected) {\n\t\t\t\tif (health === 0) {\n\t\t\t\t\tif (randNum < INF_MILD_SICK) return 1;\n\t\t\t\t\telse if (randNum < INF_MILD_SICK + INF_SEVERE_SICK) return 2;\n\t\t\t\t\telse return 0;\n\t\t\t\t} else if (health === 1) {\n\t\t\t\t\tif (randNum < INF_MILD_RECOVER) return 0;\n\t\t\t\t\telse if (randNum < INF_MILD_RECOVER + INF_MILD_TO_SEVERE) return 2;\n\t\t\t\t\telse return 1;\n\t\t\t\t} else if (health === 2 && !hospitalised) {\n\t\t\t\t\tif (randNum < INF_SEVERE_RECOVER_NO_HOSPITAL) return 0;\n\t\t\t\t\tif (randNum < INF_SEVERE_RECOVER_NO_HOSPITAL + INF_SEVERE_CONTINUE_NO_HOSPITAL) return 2;\n\t\t\t\t\telse return 3;\n\t\t\t\t} else if (health === 2 && hospitalised) {\n\t\t\t\t\tif (randNum < INF_SEVERE_RECOVER_HOSPITAL) return 0;\n\t\t\t\t\tif (randNum < INF_SEVERE_RECOVER_HOSPITAL + INF_SEVERE_CONTINUE_HOSPITAL) return 2;\n\t\t\t\t\telse return 3;\n\t\t\t\t} else if (health === 3) return 3;\n\t\t\t}\n\t\t}\n\t}\n}\n","import React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.scss';\nimport 'react-widgets/dist/css/react-widgets.css';\nimport _ from 'lodash'\nimport { loadAllData } from './DataLoading';\nimport MainVizComponent from './components/MainVizComponent/MainVizComponent';\nimport {Helmet} from \"react-helmet\";\nimport Switch from \"react-switch\";\nimport { Combobox } from 'react-widgets';\nimport { scaleQuantize, nice } from 'd3-scale';\nimport { extent } from 'd3-array';\nimport * as moment from 'moment';\nimport SimComponent from './components/SimComponent/SimComponent';\nimport {makePerson,getAllNeighbors,newWorld,getNextStateOfWorld} from './Simulate';\n\n\nclass App extends Component {\n\n  constructor() {\n    super()\n    this.state = {\n      ...this.props,\n      dimensions: {\n        width: window.innerWidth,\n        height: window.innerHeight\n      },\n      distancing: 5,\n      neighborAddresses: getAllNeighbors(32),\n      world: newWorld(32,1)\n    };\n    // this.handleTimeLineChange = this.handleTimeLineChange.bind(this)\n    // this.handleFilterYearChange = this.handleFilterYearChange.bind(this)\n    // this.handleBuyerChange = this.handleBuyerChange.bind(this)\n    // this.handleRevAsCirclesChange = this.handleRevAsCirclesChange.bind(this)\n    this.updateDimensions = this.updateDimensions.bind(this)\n    this.handleTick = this.handleTick.bind(this)\n    \n  }\n\n    \n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.updateDimensions);\n    // this.getData();\n    console.log('mounted')\n  }\n\n  updateDimensions() {\n    this.setState({\n      dimensions: {\n\t\t\t\theight: window.innerHeight, \n\t\t\t\twidth: window.innerWidth\n\t\t\t}\n    });\n  }\n\n  // handleTimeLineChange(checked) {\n  //   this.setState({ timeline: checked });\n  // }\n\n  // handleRevAsCirclesChange(checked) {\n  //   this.setState({ revAsCircles: checked });\n  // }\n  \n  // handleFilterYearChange(year,originalData) {\n  //   const filteredData = year === \"All\"\n  //     ? originalData\n  //     : originalData.filter(d => d.Date_of_sale.year() === +year)\n  //   return filteredData\n  // }\n\n  // handleBuyerChange(buyer,originalData) {\n  //   const filteredData = buyer === \"All\"\n  //     ? originalData\n  //     : originalData.filter(d => d.Buyer === buyer)\n  //   return filteredData;\n  // }\n\n  // handleDestinationChange(destination,originalData) {\n  //   const filteredData = destination === \"All\"\n  //     ? originalData\n  //     : originalData.filter(d => d.Destination === destination)\n  //   return filteredData;\n  // }\n\n  // handlePriceChange(price,originalData) {\n  //   const filteredData = price === \"All\"\n  //     ? originalData\n  //     : originalData.filter(d => d.priceRange === this.state.priceOptions.indexOf(price) - 1)\n  //   return filteredData;\n  // }\n\n  // handleAllFilters(newFilters) {\n  //   let filteredData = [...this.state.data];\n  //   const replaceOldFilters = this.state.currentFilters.map(fil => \n  //     newFilters.filter === fil.filter \n  //     ? {filter: fil.filter,filterVal: newFilters.filterVal} \n  //     : {filter: fil.filter,filterVal: fil.filterVal} \n  //   );\n  //   console.log(replaceOldFilters);\n  //   const currentFilters = replaceOldFilters.concat(\n  //     replaceOldFilters.map(fil => fil.filter).includes(newFilters.filter) \n  //       ? []\n  //       : [newFilters]\n  //   );\n  //   console.log(filteredData);\n  //   console.log(currentFilters);\n  //   for (let i = 0; i < currentFilters.length; i++) {\n  //     switch (currentFilters[i].filter) {\n  //       case('year'):\n  //         filteredData = this.handleFilterYearChange(currentFilters[i].filterVal,filteredData);\n  //         break;\n  //       case('buyer'):\n  //         filteredData = this.handleBuyerChange(currentFilters[i].filterVal,filteredData);\n  //         break;\n  //       case('destination'):\n  //         filteredData = this.handleDestinationChange(currentFilters[i].filterVal,filteredData);\n  //         break;\n  //       case('price'):\n  //         filteredData = this.handlePriceChange(currentFilters[i].filterVal,filteredData);\n  //         break;\n  //       default: break;\n  //     }\n  //   }\n  //   const [minDate,maxDate] = this.getDateExtent(filteredData);\n\n\n  //   // console.log(filteredData);\n  //   // console.log(currentFilters);\n  //   this.setState({ filteredData });\n  //   this.setState({ currentFilters });\n  //   this.setState({ minDate });\n  //   this.setState({ maxDate });\n  // }\n\n  // getDateExtent = (data) => data.length ? extent([...data.map(d=>d.Date_of_sale),...data.map(d=>d.Payment_receipt_date)]) : [moment(),moment()];\n\n  // getData() {\n  //   loadAllData()\n  //     .then(data => {\n  //       // set initial data\n  //       const pricesList = data.map(row => row.Price);\n  //       const quantizePrices = scaleQuantize()\n  //         .domain(extent(pricesList)) // pass only the extreme values to a scaleQuantizeâ€™s domain\n  //         .range([...Array(4).keys()]);\n  //       const quantizePricesNice = quantizePrices.copy().nice();\n        \n  //       const thresholds = quantizePricesNice.thresholds();\n  //       const priceRanges = thresholds.map((t,i) => i > 0 \n  //         ? \"$\" + thresholds[i-1] + \" to $\" + t\n  //         : \"$0 to $\" + t )\n  //       priceRanges.push(\">$\" + thresholds[thresholds.length-1]);\n  //       priceRanges.unshift(\"All\");\n  //       console.log(priceRanges);\n\n  //       var trimmedData = data.map(row => {\n  //         var trimmedRow = {};\n  //         Object.keys(row).forEach(key => trimmedRow[key] = typeof row[key] === 'string' ? row[key].trim(): row[key]);\n  //         trimmedRow['priceRange'] = quantizePricesNice(row['Price']);\n  //         return trimmedRow;\n  //       })\n  //       console.log(trimmedData);\n        \n  //       const [minDate,maxDate] = this.getDateExtent(trimmedData);\n\n        \n  //       var years = [\"All\", ..._.uniq(trimmedData.map(d => d.Date_of_sale.year()))];\n  //       var buyers = [\"All\", ..._.uniq(trimmedData.map(d => d.Buyer))];\n  //       var destinations = [\"All\", ..._.uniq(trimmedData.map(d => d.Destination))];\n  //       this.setState({ \n  //         data: trimmedData, \n  //         filteredData: data,\n  //         yearOptions: years,\n  //         buyerOptions: buyers,\n  //         destinationOptions: destinations,\n  //         priceOptions: priceRanges,\n  //         maxDate: maxDate,\n  //         minDate: minDate\n  //       });\n  //     })\n  // }\n\n  // makeAFilterCombo = (filter) => <div className=\"uiWidgetContainer\">\n  //   Filter by {filter}:\n  //   <Combobox\n  //     data={this.state[filter+'Options']}\n  //     defaultValue={\"All\"}\n  //     onChange={value => this.handleAllFilters({filter:filter,filterVal:value}) }\n  //   />\n  // </div>\n\n  handleTick = () => {\n    // let newWorld = getNextStateOfWorld(this.state.world,this.state.neighborAddresses,this.state.distancing);\n    setInterval(\n      this.setState({ world: getNextStateOfWorld(this.state.world,this.state.neighborAddresses,this.state.distancing) }), \n      1000)\n    ;\n  }\n\n  handleDistancing = (checked) => {\n    this.setState({ distancing: checked ? 10 : 1})\n  }\n\n  handleReset = () => {\n    this.setState({ world: newWorld(32,1) })\n  }\n\n  render() {\n    const isLoading = !!(_.isEmpty(this.state.world)) ? true : false;\n    // const jane = makePerson({initName:\"Jane\"});\n    // const jacob = makePerson({initName:\"Jacob\"});\n    // console.log(jane.calcInfected({0:[{infected:true}]},1));\n    // console.log(jacob.calcInfected({0:[{infected:true},{infected:true}],1:[{infected:true},{infected:true}]},1));\n    for (let tick = 0; tick < 150; tick++) {\n      // world = getNextStateOfWorld(world,neighborAddresses,distancing);\n      // console.log(tick);\n      // console.log(world.infections);\n    }\n\n    return (\n\n      \n      !!isLoading\n      ? null\n      : <div className=\"App\">\n\n        <header>\n        <div className=\"application\">\n            <Helmet>\n              <meta charSet=\"utf-8\" />\n              <meta name=\"viewport\" content=\"width=1100,initial-scale=0.3,shrink-to-fit=yes\" />\n            </Helmet>\n        </div>\n        </header>\n\n        {/* <div className=\"uiWidgetContainer\">\n          <label>\n            <span>Revenue as Circles</span>\n            <br/>\n            <Switch onChange={this.handleRevAsCirclesChange} checked={this.state.revAsCircles} />\n          </label>\n        </div> */}\n        <div className=\"uiWidgetContainer\">\n          <label>\n            <span>COVID-19 Simulation</span>\n            <br/>\n            <button onClick={this.handleTick}>Play</button>\n            <br/>\n            <button onClick={this.handleReset}>Reset</button>\n            <br/>\n            Distancing <Switch onChange={this.handleDistancing} checked={this.state.distancing === 10 ? true : false} />\n            <br/>\n            {/* { this.state.world.health  */}\n            <div>\n              Healthy: {this.state.world.health.healthy} | \n              Mildly Sick: {this.state.world.health.mildlySick} | \n              Severely Sick: {this.state.world.health.severelySick} | \n              Dead: {this.state.world.health.dead}\n            </div>\n            {/* : null} */}\n          </label>\n        </div>\n        {/* {this.makeAFilterCombo('buyer')}\n        {this.makeAFilterCombo('destination')}\n        {this.makeAFilterCombo('year')}\n        {this.makeAFilterCombo('price')} */}\n        <br/>\n        <br/>\n        \n        \n        \n\n        <div className=\"vizContainer\">\n        <SimComponent width={700} height={700} numPersons={1024} worldState={this.state.world} distancing={this.state.distancing}></SimComponent>\n\n        </div>\n        \n      </div>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}