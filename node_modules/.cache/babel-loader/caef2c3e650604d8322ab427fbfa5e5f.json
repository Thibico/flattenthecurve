{"ast":null,"code":"const d3 = require('d3');\n\nconst {\n  SVGConverter\n} = require('svg-dataurl');\n\nconst css = `.download-menu {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  z-index: 1000;\n  display: inline-block;\n  float: left;\n  min-width: 160px;\n  padding: 5px 0;\n  margin: 2px 0 0;\n  list-style: none;\n  font-size: 14px;\n  background-color: #fff;\n  border: 1px solid #ccc;\n  border: 1px solid rgba(0,0,0,.15);\n  border-radius: 4px;\n  -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);\n  box-shadow: 0 6px 12px rgba(0,0,0,.175);\n  background-clip: padding-box;\n}\n\n.download-menu>li>a {\n  display: block;\n  padding: 3px 20px;\n  clear: both;\n  font-weight: 400;\n  line-height: 1.42857143;\n  color: #333;\n  white-space: nowrap;\n  text-decoration: none;\n  background: 0 0;\n}\n\n.download-menu>li>a:hover, .download-menu>li>a:focus {\n  text-decoration: none;\n  color: #262626;\n  background-color: #f5f5f5;\n}`;\n\nconst createMenu = (pos, filename, converter) => {\n  const menu = d3.select('body').append('ul').classed('download-menu', true).style('left', `${pos[0]}px`).style('top', `${pos[1]}px`).on('mouseleave', () => {\n    menu.remove();\n  });\n  const list = menu.append('li');\n  list.append('a').text('Save as SVG').attr('download', filename + '.svg').attr('href', converter.svgDataURL());\n  list.append('a').text('Save as PNG').attr('download', filename + '.png').attr('href', converter.pngDataURL());\n  list.append('a').text('Save as JPG').attr('download', filename + '.jpeg').attr('href', converter.jpegDataURL());\n};\n\nconst downloadable = () => {\n  let filename = 'image';\n\n  const downloadableImpl = selection => {\n    if (d3.select('#downloadable-css').empty()) {\n      d3.select('head').append('style').attr('id', 'downloadable-css').text(css);\n    }\n\n    selection.on('contextmenu', () => {\n      const f = () => {\n        const pos = d3.mouse(document.body);\n        SVGConverter.loadFromElement(selection.node()).then(converter => {\n          createMenu(pos, filename, converter);\n        });\n        d3.event.preventDefault();\n      };\n\n      if (d3.event == null) {\n        d3.customEvent(window.event, f); // Hack for React\n      } else {\n        f();\n      }\n    });\n  };\n\n  downloadableImpl.filename = function () {\n    if (arguments.length === 0) {\n      return filename;\n    }\n\n    filename = arguments[0];\n    return downloadableImpl;\n  };\n\n  return downloadableImpl;\n};\n\nexports.downloadable = downloadable;","map":null,"metadata":{},"sourceType":"script"}